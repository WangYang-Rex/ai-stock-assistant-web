{
  "swagger": "2.0",
  "info": {
    "title": "Trends API",
    "description": "股票分时数据相关接口",
    "version": "1.0.0"
  },
  "basePath": "/",
  "tags": [
    {
      "name": "Trends",
      "description": "股票分时数据管理"
    }
  ],
  "paths": {
    "/api/trends/sync-from-api": {
      "post": {
        "tags": [
          "Trends"
        ],
        "summary": "从东方财富 SDK 同步分时数据到数据库",
        "description": "支持同步当日分时（ndays=1）或5日分时（ndays=5）数据到数据库（增量更新）",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "required": [
                "code",
                "market"
              ],
              "properties": {
                "code": {
                  "type": "string",
                  "description": "股票代码（如：600519）"
                },
                "market": {
                  "type": "integer",
                  "description": "市场代码（1-上交所，0-深交所）"
                },
                "ndays": {
                  "type": "integer",
                  "description": "获取天数（1-当日分时，5-5日分时，默认为1）",
                  "default": 1
                }
              }
            }
          }
        ],
        "responses": {
          "201": {
            "description": "同步结果",
            "schema": {
              "type": "object",
              "properties": {
                "synced": {
                  "type": "integer",
                  "description": "已同步条数"
                },
                "total": {
                  "type": "integer",
                  "description": "总条数"
                },
                "newAdded": {
                  "type": "integer",
                  "description": "新增加条数"
                }
              }
            }
          }
        }
      }
    },
    "/api/trends/sync-all-stocks": {
      "post": {
        "tags": [
          "Trends"
        ],
        "summary": "同步所有股票的当日分时数据",
        "description": "遍历数据库中的所有股票，抓取其当日分时数据并更新到本地数据库",
        "responses": {
          "200": {
            "description": "同步成功",
            "schema": {
              "type": "object",
              "properties": {
                "success": { "type": "integer" },
                "fail": { "type": "integer" },
                "totalSynced": { "type": "integer" }
              }
            }
          }
        }
      }
    },
    "/api/trends/list": {
      "post": {
        "tags": [
          "Trends"
        ],
        "summary": "获取分时数据列表",
        "description": "支持分页、股票代码过滤及时间范围过滤",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "code": {
                  "type": "string",
                  "description": "股票代码（可选）"
                },
                "ndays": {
                  "type": "integer",
                  "description": "获取最近 N 天的数据（可选，1 或 5）"
                },
                "startDatetime": {
                  "type": "string",
                  "description": "开始时间（可选，格式：YYYY-MM-DD HH:mm）"
                },
                "endDatetime": {
                  "type": "string",
                  "description": "结束时间（可选，格式：YYYY-MM-DD HH:mm）"
                },
                "page": {
                  "type": "integer",
                  "description": "页码",
                  "default": 1
                },
                "limit": {
                  "type": "integer",
                  "description": "每页数量",
                  "default": 10
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取分时数据列表",
            "schema": {
              "type": "object",
              "properties": {
                "trends": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/Trend"
                  }
                },
                "total": {
                  "type": "integer",
                  "description": "总记录数"
                }
              }
            }
          }
        }
      }
    },
    "/api/trends/delete-range": {
      "post": {
        "tags": [
          "Trends"
        ],
        "summary": "根据代码和日期范围批量删除分时数据",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "required": [
                "code",
                "startDatetime",
                "endDatetime"
              ],
              "properties": {
                "code": {
                  "type": "string",
                  "description": "股票代码"
                },
                "startDatetime": {
                  "type": "string",
                  "description": "开始时间（格式：YYYY-MM-DD HH:mm）"
                },
                "endDatetime": {
                  "type": "string",
                  "description": "结束时间（格式：YYYY-MM-DD HH:mm）"
                }
              }
            }
          }
        ],
        "responses": {
          "201": {
            "description": "删除成功"
          }
        }
      }
    }
  },
  "definitions": {
    "Trend": {
      "type": "object",
      "properties": {
        "id": {
          "type": "integer",
          "description": "主键ID"
        },
        "code": {
          "type": "string",
          "description": "股票代码"
        },
        "name": {
          "type": "string",
          "description": "股票名称"
        },
        "datetime": {
          "type": "string",
          "description": "日期时间（YYYY-MM-DD HH:mm 格式）"
        },
        "price": {
          "type": "number",
          "description": "当前价格"
        },
        "avgPrice": {
          "type": "number",
          "description": "均价"
        },
        "volume": {
          "type": "integer",
          "description": "成交量（股）"
        },
        "amount": {
          "type": "number",
          "description": "成交额（元）"
        },
        "pct": {
          "type": "number",
          "description": "涨跌幅（%）"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "系统创建时间"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "系统更新时间"
        }
      }
    }
  }
}
